<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/pages.css">
  <link rel="stylesheet" href="css/menu.css">
  <title>Central do Usuário</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="shortcut icon" href="img/ADN_Red.png" type="image/x-icon"/>

 <style>
  :root {
    --cor-primaria: #4A90E2;
    --cor-secundaria: #357ABD;

    --cor-texto: #333;
    --cor-box: #fff;

    --cor-logout: #e74c3c;
    --cor-logout-hover: #c0392b;

    --gradient-neon: linear-gradient(135deg, #6a11cb, #2575fc);

    --radius: 14px;
    --radius-large: 18px;

    --shadow: 0 4px 15px rgba(0,0,0,0.15);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--gradient-neon);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  /* ===== LOADING ===== */
  #loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    gap: 16px;
    font-size: 1.1rem;
    animation: fadeIn .5s ease;
  }

  .spinner {
    width: 48px;
    height: 48px;
    border: 5px solid rgba(255,255,255,0.2);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin .6s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* ===== DASHBOARD ===== */
  #dashboard {
    display: none;
    background: var(--cor-box);
    padding: 40px 32px;
    border-radius: var(--radius-large);
    width: min(420px, 94%);
    text-align: center;
    box-shadow: var(--shadow);
    animation: fadeIn .4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  #dashboard h2 {
    color: var(--cor-primaria);
    margin-bottom: 20px;
    font-weight: 600;
  }

  #user-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--cor-primaria);
    margin-bottom: 16px;
    transition: transform .25s ease;
  }

  #user-avatar:hover {
    transform: scale(1.05);
  }

  .user-info p {
    color: var(--cor-texto);
    margin: 6px 0;
  }

  /* ===== BOTÕES ===== */
  button {
    width: 100%;
    padding: 14px;
    margin-top: 12px;
    border: none;
    border-radius: var(--radius);
    font-size: 1rem;
    cursor: pointer;
    background: var(--cor-primaria);
    color: #fff;
    transition: .25s ease;
    box-shadow: var(--shadow);
  }

  button:hover {
    background: var(--cor-secundaria);
    transform: translateY(-2px);
  }

  .logout-btn {
    background: var(--cor-logout);
  }

  .logout-btn:hover {
    background: var(--cor-logout-hover);
  }

  /* ===== ADMIN ===== */
  #admin-section {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 2px solid #ddd;
    display: none;
  }

  #admin-section h3 {
    color: var(--cor-primaria);
    margin-bottom: 10px;
    font-weight: 600;
  }
</style>


</head>

<body>


<div id="loading">
    <div class="spinner"></div>
    Carregando...
</div>

<div id="dashboard">

  <h2><i class="fas fa-user-circle"></i> Central do Usuário</h2>

  <img id="user-avatar" src="img/anonimo.png" alt="Foto do usuário"/>

  <div class="user-info">
    <p><strong>Nome:</strong> <span id="user-name">Carregando...</span></p>
    <p><strong>Email:</strong> <span id="user-email">Carregando...</span></p>
    <p><strong>Papel:</strong> <span id="user-role">Carregando...</span></p>
  </div>

  <button onclick="voltarParaInicio()"><i class="fas fa-arrow-left"></i> Voltar</button>
  <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>

  <!-- Admin -->
  <div id="admin-section">
    <h3><i class="fas fa-shield-alt"></i> Área do Admin</h3>

    <button onclick="window.location.href='users.html'">
      <i class="fas fa-users"></i> Gerenciar Usuários
    </button>

    <button onclick="window.location.href='players.html'">
      <i class="fas fa-gamepad"></i> Gerenciar Players
    </button>
  </div>

</div>



<script type="module">
  import { auth, db } from "./js/Auth.js";
  import { signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

  // Pre-carrega info da memória local
  const nome = localStorage.getItem('username');
  const email = localStorage.getItem('useremail');
  const foto = localStorage.getItem('userphoto');

  if (nome) document.getElementById("user-name").innerText = nome;
  if (email) document.getElementById("user-email").innerText = email;
  if (foto) document.getElementById("user-avatar").src = foto;

  // Listener único
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    try {
      const userDocRef = doc(db, "users", user.email);
      const userDocSnap = await getDoc(userDocRef);

      let role = "Usuário Comum";

      if (userDocSnap.exists()) {
        role = userDocSnap.data().role || role;
      }

      // Atualiza na tela
     document.getElementById("user-role").innerText =
      role.charAt(0).toUpperCase() + role.slice(1);

     // EXIBE A SEÇÃO DE ADMIN SE FOR ADMIN
     if (role.toLowerCase() === "admin") {
      document.getElementById("admin-section").style.display = "block";
     }

      document.getElementById("user-role").innerText =
        role.charAt(0).toUpperCase() + role.slice(1);

    } catch (error) {
      console.error("Erro ao buscar papel:", error);
      document.getElementById("user-role").innerText = "Erro ao carregar";
    }

    // mostra dashboard
    document.getElementById("loading").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
  });

  // Funções globais
  window.voltarParaInicio = () => window.location.href = "index.html";

  window.logout = () => {
    signOut(auth).then(() => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  };

  
</script>
<script type="module" src="js/script.js"></script>
</body>
</html>
